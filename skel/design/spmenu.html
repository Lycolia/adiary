<@6>
<@local(s,t,pi,items)>
<$s = v.blog>

<@> システムモード
<$v.system_mode("スマホメニューの表示設定")>

<!--========================================================================-->
<@> 階層ツリー、初期処理
<@call("<@v.skel_dir>_dir_tree")>

<$items = v.load_spmenu_items()>
<$ifjump(!items, '_sub/error_message', '利用可能なデザインモジュール（コンテンツリスト等）がインストールされていません。')>

<$v.append_header(exec(begin))>
<style>
#body table.blog-setting td {
	padding:	2px 6px;
}
#body table.blog-setting tbody tr {
	background-color:	#ffffee;
	color:			#000;
}

#body table.blog-setting td.html ul {
	max-height:	40px;
	overflow:	hidden;
	padding:	0 0 0 20px;
	margin:		0;

	font-size:	10pt;
	line-height:	100%;
}
<@ifexec(v.sphone, begin)>
#body table.blog-setting td {
	padding:	2px;
}
#body table.blog-setting th {
	font-size:	9pt;
}
#body table.blog-setting td,
#body table.blog-setting td input {
	font-size:	8pt;
}
#body table.blog-setting td.html ul {
	max-width:	100px;
}
<$end>
</style>
<script>
$(function(){
	var tbody = $('#sortable-body');
	tbody.sortable({ items: '>tr', cancel: '.no-drag' });
	tbody.dndEmulation();	// for スマホ
});
</script>
<$end>

<!--========================================================================-->
<article class="system setting">
<h2><@v.title></h2>
<div class="body">
	<form action="<@v.myself>?<@v.skeleton>" method="POST" id="form">
	<input type="hidden" name="action" value="<@v.skeleton>">
	<input type="hidden" name="csrf_check_key" value="<@CSRF_check_key>">

	<p>使用するモジュールを選択してください。モジュール名をドラッグアップドロップすると並べ替えられます。</p>

	<table class="blog-setting">
	<thead><tr>
		<th>使用</th>
		<th>項目タイトル</th>
		<th>モジュール名</th>
		<th>内容表示</th>
	</tr></thead><tbody id="sortable-body">
	<@forexec(t, items, begin)><$pi=v.load_plugin_info(t.name)>
	<tr>
		<td class="nowrap no-drag">
			<input type="checkbox" name="mod_ary" value="<@t.name>"<@if(t.on, ' checked')>>
		</td>
		<td class="no-drag">
			<input type="text" class="<@if(v.sphone, 'w80', 'w140')>" name="<@t.name>" value="<@t.title || pi.title>">
		</td>
		<td><@t.name></td>
		<td class="html"><@t.html></td>
	</tr>
	<$end>
	</tbody>
	</table>
	
	<p>タイトル<span class="help" data-help="使用するモジュールが2つ以上ある時、全体のタイトルとして使用されます。">?</span>
	<input class="w300" type="text" name="spmenu_title" value="<@s.spmenu_title || 'メニュー'>"></p>


	<button type="submit" id="submit">保存する</button>
	<button type="button" id="reset">リセット</button><br>
	</form>

</div>
</article>
