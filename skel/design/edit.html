<@6>
<@local(s,tp,t)>
<$s = v.blog>
<$ifredirect(!v.blog_admin, v.myself)>

<@><!--========================================================================-->
<@> システムモード
<$v.special_system_mode("デザイン編集")>

<$v.regist_js("<@v.script_dir>design-edit.js")>
<$plain_html_mode = 1>

<$v.append_header(exec(begin))>
<style>
#adiary-body {
	display:	none;
}
* {
	margin:		0;
	padding:	0;
}
html, #body {
	height:		100%;
	overflow:	hidden;
<@ifexec(!Develop, begin)>
	overflow:	hidden;
<$end>
}
#body {
	background-color:	#008;
	font-size:		11pt;
}
#right-buttons {
	position:		absolute;
	right:			4px;
}
#right-buttons button {
	margin:			1px;
}
#form {
	color:			#fff;
	margin:			2px 4px;
}
#form button + button {
	margin:			inherit;
}
button {
	padding:		0 3px;
}
select {
	padding:		0px 1px;
}
#iframe {
	width:			100%;
	min-height:		0;
	overflow-x:		hidden;
	overflow-y:		scrollbar;
	border:			none;
	background-color:	#fff;

	position:		absolute;
	left:			0px;
}
</style>
<$end>
<!--========================================================================-->
<$mods = v.load_modules_info()>
<$mods = sort_str(mods, 'title')>

<form id="form">
デザイン編集
<select name="modules" id="module-type">
<option value="sidebar">サイドバー</option>
<option value="header">ヘッダー</option>
<option value="main">メイン</option>
</select>

<select name="modules" id="add-module">
</select>


<button id="save-btn" type="button">保存</button>
<button id="back-btn" type="button" onclick="window.location='<@v.myself>?<@v.skel_dir>'">戻る</button>
<input type="checkbox" id="display-modules" class="js-save"><label>表示</label>
</form>


<iframe id="iframe" src="<@v.myself>?<@v.skel_dir>art_sample"></iframe>

<!-- デザインモジュールの情報 =============================================-->
<div class="js-hook-stop" id="design-modules-data" style="display: none">
<@forexec(t, mods, begin)>
<$ifnext(t.adiary_version > v.VERSION)> <@>  対応Versionチェック
<div title="<@t.title>"
 data-module-name="<@t.name>"
 data-type="<@t.module_type>"
 data-setting="<@if(t.module_setting,1)>"
 data-css-setting="<@if(t.css_setting,1)>"
 data-load-module-html="<@t.load_module_html_in_edit>"
 data-readme="<@if(t.readme,1)>"
 data-readme-url="<@Myself>?set2/plugin_readme&amp;name=<@t.name>"
 data-readme-title="<@t.name>のREADME"
>
<@t.sample_html>
</div>
<$end>
</div>


<!-- フォーム -->
<form action="<@v.myself>?<@v.skeleton>" method="POST" id="js-form">
<input type="hidden" name="action" value="<@v.skeleton>">
<input type="hidden" name="csrf_check_key" value="<@CSRF_check_key>">
</form>

<!-- モジュール設定画面用フォーム -->
<form method="POST" id="setting-form"
 data-setting-url="<@v.myself>?set2/plugin_setting&amp;name=">
<input type="hidden" name="action" value="set2/plugin_setting">
<input type="hidden" name="csrf_check_key" value="<@CSRF_check_key>">
</form>

<!-- モジュールHTMLロード用フォーム -->
<form method="POST" id="load-module-form">
<input type="hidden" name="action" value="design/load_module">
<input type="hidden" name="csrf_check_key" value="<@CSRF_check_key>">
<input type="hidden" name="module_name" id="js-load-module-name">
</form>


<@call('_sub/ajax_messages')>
<div style="display:none">
<span id="msg-append-module-select">（追加モジュール選択）</span>
<span id="msg-delete-confirm">「%n」を削除しますか？</span>
<span id="msg-duplicate-id">「%n」は既に存在します（１つしか追加できません）</span>
<span id="btn-css-setting">デザイン設定</span>
<span id="btn-view-html">HTML表示</span>
<span id="msg-html-source">HTMLソース</span>
<span id="user-css-url" data-url="<@Basepath><@v.blogpub_dir>dynamic.css"></span>
</div>
